<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mattepromenaden</title>

<style>
* { box-sizing: border-box; user-select: none; }
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #1e3a8a;
  overflow: hidden;
}

/* ===== SPEL ===== */
#game {
  position: relative;
  height: 60vh;
  background: linear-gradient(#60a5fa, #86efac);
  overflow: hidden;
}
#world {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 3600px;
  height: 100%;
}
.ground {
  position: absolute;
  bottom: 0;
  width: 3600px;
  height: 80px;
  background: #22c55e;
}

/* ===== HINDER ===== */
.obstacle {
  position: absolute;
  bottom: 80px;
  width: 50px;
  height: 40px;
  background: #7c3aed;
  border-radius: 10px;
  color: white;
  font-size: 1.6rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== GUBBE ===== */
#player {
  position: absolute;
  left: 45%;
  bottom: 80px;
  width: 40px;
}
.head {
  width: 24px;
  height: 24px;
  background: #fde68a;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.body {
  width: 40px;
  height: 28px;
  background: #2563eb;
  border-radius: 8px;
  margin-top: 4px;
}
.legs {
  display: flex;
  justify-content: space-between;
}
.leg {
  width: 16px;
  height: 20px;
  background: #1e293b;
  border-radius: 6px;
}

/* ===== KONTROLLER ===== */
#controls {
  display: flex;
  justify-content: center;
  gap: 30px;
  padding: 12px;
  background: #0f172a;
}
button {
  font-size: 1.8rem;
  padding: 12px 18px;
  border-radius: 14px;
  border: none;
  background: #1e3a8a;
  color: white;
}

/* ===== MATTE ===== */
#mathOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: none;
  align-items: center;
  justify-content: center;
}

.gridWrapper {
  background: white;
  padding: 16px;
  border: 3px solid #0f172a;
}

.grid {
  display: grid;
  grid-template-columns: 56px 56px 56px;
  grid-template-rows: 56px 56px 56px 56px;
}

/* varje cell */
.cell {
  border: 2px solid black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  background: white;
}

/* fet linje UNDER rad 3 */
.row3 {
  border-bottom: 6px solid black !important;
}

/* f√§rger */
.ones { color: #16a34a; font-weight: 700; background: #f1f5f9; }
.tens { color: #2563eb; font-weight: 600; }
.op { font-weight: 700; }

/* inputs */
input {
  width: 100%;
  height: 100%;
  border: none;
  font-size: 2rem;
  text-align: center;
  background: transparent;
}

/* fokus */
.green-focus { box-shadow: inset 0 0 0 4px rgba(22,163,74,.4); }
.blue-focus  { box-shadow: inset 0 0 0 4px rgba(37,99,235,.4); }
</style>
</head>

<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>
    <div class="obstacle" style="left:900px">?</div>
    <div class="obstacle" style="left:1800px">?</div>
    <div class="obstacle" style="left:2700px">?</div>
  </div>

  <div id="player">
    <div class="head">üôÇ</div>
    <div class="body"></div>
    <div class="legs">
      <div class="leg"></div>
      <div class="leg"></div>
    </div>
  </div>
</div>

<div id="controls">
  <button id="leftBtn">‚¨ÖÔ∏è</button>
  <button id="jumpBtn">‚¨ÜÔ∏è</button>
  <button id="rightBtn">‚û°Ô∏è</button>
</div>

<div id="mathOverlay">
  <div class="gridWrapper">
    <div class="grid" id="grid"></div>
    <div style="text-align:center;margin-top:10px">
      <button onclick="check()">Klar</button>
    </div>
  </div>
</div>

<script>
/* ===== TAL ===== */
const tasks = ["39+15","63+28","58+34"];
let taskIndex = 0;
let correct = 0;
let paused = false;

const grid = document.getElementById("grid");

/* ===== SPEL ===== */
let worldX=0, vy=0, onGround=true;
let left=false, right=false;
const speed=3, gravity=0.6;

leftBtn.onpointerdown=e=>{e.preventDefault();left=true};
leftBtn.onpointerup=()=>left=false;
rightBtn.onpointerdown=e=>{e.preventDefault();right=true};
rightBtn.onpointerup=()=>right=false;
jumpBtn.onpointerdown=e=>{
  e.preventDefault();
  if(onGround){vy=11;onGround=false;}
};

function showMath(){
  paused=true;
  grid.innerHTML="";

  const [a,b]=tasks[taskIndex].split("+").map(Number);
  correct=a+b;

  const cells=[
    "","","",
    "",Math.floor(a/10),a%10,
    "+",Math.floor(b/10),b%10,
    "i","i","i"
  ];

  cells.forEach((v,i)=>{
    const c=document.createElement("div");
    c.className="cell";
    if(i>=6 && i<=8) c.classList.add("row3");

    if(v==="i"){
      const inp=document.createElement("input");
      inp.inputMode="numeric";
      inp.maxLength=1;
      c.appendChild(inp);
    } else if(v==="+"){
      c.textContent="+";
      c.classList.add("op");
    } else if(typeof v==="number"){
      c.textContent=v;
      if(i%3===2) c.classList.add("ones","green-focus");
      if(i%3===1) c.classList.add("tens");
    }
    grid.appendChild(c);
  });

  const inputs=[...grid.querySelectorAll("input")];
  inputs[2].addEventListener("input",()=>{
    grid.querySelectorAll(".green-focus").forEach(e=>e.classList.remove("green-focus"));
    grid.querySelectorAll(".tens").forEach(e=>e.classList.add("blue-focus"));
  },{once:true});

  document.getElementById("mathOverlay").style.display="flex";
}

function check(){
  const v=[...grid.querySelectorAll("input")].map(i=>i.value||"").join("");
  if(parseInt(v)===correct){
    document.getElementById("mathOverlay").style.display="none";
    paused=false;
    taskIndex++;
  }
}

function loop(){
  if(!paused){
    let next=worldX;
    if(right) next-=speed;
    if(left) next+=speed;

    vy-=gravity;
    let bottom=parseFloat(player.style.bottom||80)+vy;
    if(bottom<=80){bottom=80;vy=0;onGround=true;}

    world.style.left=next+"px";
    worldX=next;
    player.style.bottom=bottom+"px";

    document.querySelectorAll(".obstacle").forEach(o=>{
      const pr=player.getBoundingClientRect();
      const r=o.getBoundingClientRect();
      if(pr.right>r.left && pr.left<r.right){
        showMath();
        o.remove();
      }
    });
  }
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mattepromenaden – spelbas</title>

<style>
*{
  box-sizing:border-box;
  user-select:none;
  -webkit-user-select:none;
  -webkit-tap-highlight-color:transparent;
}
body{
  margin:0;
  background:#60a5fa;
  font-family:system-ui,sans-serif;
  overflow:hidden;
}

/* ===== SPEL ===== */
#game{
  position:relative;
  height:60vh;
  background:linear-gradient(#60a5fa,#86efac);
  overflow:hidden;
}
#world{
  position:absolute;
  bottom:0;
  left:0;
  width:4000px;
  height:100%;
}
.ground{
  position:absolute;
  bottom:0;
  width:4000px;
  height:80px;
  background:#22c55e;
}
.hill{
  position:absolute;
  bottom:80px;
  left:900px;
  width:200px;
  height:100px;
  background:#4b5563;
  border-radius:100px 100px 0 0;
}

/* ===== PLAYER (VIDEO + IMAGE) ===== */
#player{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:80px;
  width:70px;
  pointer-events:none;
}
#player img,
#player video{
  width:100%;
  height:auto;
  display:block;
}

/* ===== HUND ===== */
#dog{
  position:absolute;
  bottom:80px;
  width:64px;
  pointer-events:none;
}
#dog img{
  width:100%;
  height:auto;
  display:block;
}

/* ===== KONTROLLER ===== */
#controls{
  display:flex;
  justify-content:center;
  gap:30px;
  padding:12px;
  background:#0f172a;
}
button{
  font-size:1.8rem;
  padding:12px 18px;
  border-radius:14px;
  border:none;
  background:#1e3a8a;
  color:white;
}
</style>
</head>

<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>
    <div class="hill"></div>
  </div>

  <!-- PLAYER -->
  <div id="player">
    <video id="playerWalk"
      src="player-walk.mp4"
      muted
      loop
      playsinline
      preload="auto"
      style="display:none">
    </video>
    <img id="playerIdle" src="player-idle.png" alt="Gubbe">
  </div>

  <!-- HUND -->
  <div id="dog">
    <img id="dogImg" src="dog-sit.png" alt="Hund">
  </div>
</div>

<div id="controls">
  <button id="leftBtn">⬅️</button>
  <button id="jumpBtn">⬆️</button>
  <button id="rightBtn">➡️</button>
</div>

<audio id="bgMusic" src="Music.mp3" loop></audio>
<audio id="jumpSound" src="Jump.mp3"></audio>

<script>
/* ===== LJUD (iOS-säkert) ===== */
let audioStarted=false;
function startAudio(){
  if(!audioStarted){
    bgMusic.volume=0.3;
    bgMusic.play().catch(()=>{});
    audioStarted=true;
  }
}

/* ===== SPELLOGIK ===== */
let worldX=0;
let vy=0;
let onGround=true;
let left=false, right=false;

const speed=3;
const gravity=0.6;

const playerWalk=document.getElementById("playerWalk");
const playerIdle=document.getElementById("playerIdle");
const dogImg=document.getElementById("dogImg");

function showWalk(){
  playerIdle.style.display="none";
  playerWalk.style.display="block";
  playerWalk.play().catch(()=>{});
  dogImg.src="dog-walk.png";
}
function showIdle(){
  playerWalk.pause();
  playerWalk.style.display="none";
  playerIdle.style.display="block";
  dogImg.src="dog-sit.png";
}

leftBtn.onpointerdown=()=>{
  left=true;
  showWalk();
  startAudio();
};
leftBtn.onpointerup=stopMove;

rightBtn.onpointerdown=()=>{
  right=true;
  showWalk();
  startAudio();
};
rightBtn.onpointerup=stopMove;

function stopMove(){
  left=false;
  right=false;
  showIdle();
}

jumpBtn.onpointerdown=()=>{
  startAudio();
  if(onGround){
    jumpSound.currentTime=0;
    jumpSound.play().catch(()=>{});
    vy=11;
    onGround=false;
  }
};

function loop(){
  if(right) worldX -= speed;
  if(left) worldX += speed;

  vy -= gravity;
  let bottom = parseFloat(player.style.bottom || 80) + vy;

  if(bottom <= 80){
    bottom = 80;
    vy = 0;
    onGround = true;
  }

  const hill = document.querySelector(".hill");
  const hillRect = hill.getBoundingClientRect();
  const playerRect = player.getBoundingClientRect();
  if(
    playerRect.bottom <= hillRect.top + 10 &&
    playerRect.right > hillRect.left &&
    playerRect.left < hillRect.right &&
    vy <= 0
  ){
    bottom = hillRect.top - game.getBoundingClientRect().bottom;
    vy = 0;
    onGround = true;
  }

  world.style.left = worldX + "px";
  player.style.bottom = bottom + "px";

  // hund följer bakom
  const gameRect = game.getBoundingClientRect();
  dog.style.left = (playerRect.left - gameRect.left - 70) + "px";

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
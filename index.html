<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mattepromenaden</title>

<style>
*{
  box-sizing:border-box;
  user-select:none;
  -webkit-user-select:none;
  -webkit-tap-highlight-color:transparent;
}
body{
  margin:0;
  overflow:hidden;
  background:#60a5fa;
  font-family:system-ui,sans-serif;
}

/* ===== SPEL ===== */
#game{
  position:relative;
  height:60vh;
  background:linear-gradient(#60a5fa,#86efac);
  overflow:hidden;
}

#world{
  position:absolute;
  bottom:0;
  left:0;
  width:5000px;
  height:100%;
}

.ground{
  position:absolute;
  bottom:0;
  width:5000px;
  height:80px;
  background:#22c55e;
}

.hill{
  position:absolute;
  bottom:80px;
  left:1000px;
  width:220px;
  height:120px;
  background:#4b5563;
  border-radius:120px 120px 0 0;
}

/* ===== PLAYER ===== */
#player{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:80px;
  width:80px;
  pointer-events:none;
}

#player img{
  width:100%;
  height:auto;
  display:block;
}

/* ===== DOG ===== */
#dog{
  position:absolute;
  bottom:80px;
  width:70px;
  pointer-events:none;
}
#dog img{
  width:100%;
  display:block;
}

/* ===== CONTROLS ===== */
#controls{
  display:flex;
  justify-content:center;
  gap:30px;
  padding:14px;
  background:#0f172a;
}
button{
  font-size:1.8rem;
  padding:12px 18px;
  border-radius:14px;
  border:none;
  background:#1e3a8a;
  color:white;
}
</style>
</head>

<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>
    <div class="hill"></div>
  </div>

  <!-- PLAYER -->
  <div id="player">
    <img id="playerImg" src="player-idle.png">
  </div>

  <!-- DOG -->
  <div id="dog">
    <img id="dogImg" src="dog-sit.png">
  </div>
</div>

<div id="controls">
  <button id="leftBtn">⬅️</button>
  <button id="jumpBtn">⬆️</button>
  <button id="rightBtn">➡️</button>
</div>

<audio id="bgMusic" src="Music.mp3" loop></audio>
<audio id="jumpSound" src="Jump.mp3"></audio>

<script>
/* ===== AUDIO (iPad safe) ===== */
let audioStarted=false;
function startAudio(){
  if(!audioStarted){
    bgMusic.volume=0.3;
    bgMusic.play().catch(()=>{});
    audioStarted=true;
  }
}

/* ===== GAME STATE ===== */
let worldX=0;
let vy=0;
let onGround=true;
let movingLeft=false;
let movingRight=false;

const speed=4;
const gravity=0.6;

const playerImg=document.getElementById("playerImg");
const dogImg=document.getElementById("dogImg");

/* ===== PLAYER IMAGE CONTROL ===== */
function updatePlayerImage(){
  if(movingLeft || movingRight){
    playerImg.src="player-walk.gif";
    dogImg.src="dog-walk.png";
  }else{
    playerImg.src="player-idle.png";
    dogImg.src="dog-sit.png";
  }
}

/* ===== CONTROLS ===== */
leftBtn.onpointerdown=()=>{
  movingLeft=true;
  updatePlayerImage();
  startAudio();
};
rightBtn.onpointerdown=()=>{
  movingRight=true;
  updatePlayerImage();
  startAudio();
};

leftBtn.onpointerup=stopMove;
rightBtn.onpointerup=stopMove;

function stopMove(){
  movingLeft=false;
  movingRight=false;
  updatePlayerImage();
}

jumpBtn.onpointerdown=()=>{
  startAudio();
  if(onGround){
    jumpSound.currentTime=0;
    jumpSound.play().catch(()=>{});
    vy=12;
    onGround=false;
  }
};

/* ===== GAME LOOP ===== */
function loop(){

  if(movingRight) worldX -= speed;
  if(movingLeft) worldX += speed;

  vy -= gravity;
  let bottom = parseFloat(player.style.bottom || 80) + vy;

  if(bottom <= 80){
    bottom=80;
    vy=0;
    onGround=true;
  }

  // Hill collision
  const hillRect=document.querySelector(".hill").getBoundingClientRect();
  const playerRect=player.getBoundingClientRect();
  if(
    playerRect.bottom <= hillRect.top + 10 &&
    playerRect.right > hillRect.left &&
    playerRect.left < hillRect.right &&
    vy <= 0
  ){
    bottom = hillRect.top - game.getBoundingClientRect().bottom;
    vy=0;
    onGround=true;
  }

  world.style.left=worldX+"px";
  player.style.bottom=bottom+"px";

  // Dog follow
  const gameRect=game.getBoundingClientRect();
  dog.style.left=(playerRect.left - gameRect.left - 80)+"px";

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
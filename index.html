<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mattepromenaden</title>

<style>
*{
  box-sizing:border-box;
  user-select:none;
  -webkit-user-select:none;
  -webkit-tap-highlight-color:transparent;
  -webkit-touch-callout:none;
}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#1e3a8a;
  overflow:hidden;
}

/* ===== SPEL ===== */
#game{
  position:relative;
  height:60vh;
  background:linear-gradient(#60a5fa,#86efac);
  overflow:hidden;
}
#world{
  position:absolute;
  bottom:0;
  left:0;
  width:7000px;
  height:100%;
}
.ground{
  position:absolute;
  bottom:0;
  width:7000px;
  height:80px;
  background:#22c55e;
}

/* ===== MILJ√ñ ===== */
.sun{
  position:absolute;
  top:20px; right:40px;
  width:80px; height:80px;
  background:#fde047;
  border-radius:50%;
}
.tree{
  position:absolute;
  bottom:80px;
  width:40px; height:90px;
}
.tree::before{
  content:"";
  position:absolute;
  bottom:0; left:14px;
  width:12px; height:40px;
  background:#92400e;
}
.tree::after{
  content:"";
  position:absolute;
  bottom:30px; left:-15px;
  width:70px; height:60px;
  background:#16a34a;
  border-radius:50%;
}
.bush{
  position:absolute;
  bottom:80px;
  width:60px; height:30px;
  background:#15803d;
  border-radius:20px;
}
.flower{
  position:absolute;
  bottom:80px;
  width:14px; height:14px;
  background:#f472b6;
  border-radius:50%;
}
.flower::after{
  content:"";
  position:absolute;
  top:14px; left:6px;
  width:2px; height:12px;
  background:#15803d;
}

/* ===== KULLAR (PLATTFORMAR) ===== */
.hill{
  position:absolute;
  bottom:80px;
  width:200px;
  height:90px;
  background:#4b5563;
  border-radius:100px 100px 0 0;
}

/* ===== HINDER ===== */
.hedgehog{
  position:absolute;
  bottom:80px;
  width:38px;
  height:22px;
  background:#92400e;
  border-radius:12px;
}
.hedgehog::before{
  content:"";
  position:absolute;
  top:-12px; left:-2px;
  width:42px; height:16px;
  background:#78350f;
  clip-path:polygon(
    0% 100%,10% 0%,20% 100%,30% 0%,40% 100%,
    50% 0%,60% 100%,70% 0%,80% 100%,90% 0%,100% 100%
  );
}
.cube{
  position:absolute;
  bottom:80px;
  width:44px; height:44px;
  background:#7c3aed;
  border-radius:8px;
  color:white;
  font-size:1.8rem;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== M√ÖLFLAGGA ===== */
.flag{
  position:absolute;
  bottom:80px;
  left:6400px;
}
.flagpole{
  width:6px;
  height:140px;
  background:white;
}
.flagcloth{
  position:absolute;
  left:6px;
  bottom:0;
  width:40px;
  height:30px;
  background:
    repeating-linear-gradient(
      90deg,
      black 0 10px,
      white 10px 20px
    );
  transition:bottom 1s ease;
}
.flag.raised .flagcloth{
  bottom:100px;
}

/* ===== GUBBE ===== */
#player{
  position:absolute;
  left:45%;
  bottom:80px;
  width:40px;
}
.head{
  width:24px; height:24px;
  background:#fde68a;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto;
}
.body{
  width:20px; height:28px;
  background:#2563eb;
  border-radius:6px;
  margin:2px auto 0;
  position:relative;
}
.arm{
  position:absolute;
  top:8px;
  width:10px; height:4px;
  background:#fde68a;
}
.arm.left{ left:-10px; }
.arm.right{ right:-10px; }
.legs{
  display:flex;
  justify-content:space-between;
  width:30px;
  margin:0 auto;
}
.leg{
  width:12px; height:20px;
  background:#1e293b;
  border-radius:6px;
}
.walking .leg{
  animation:walk .25s alternate infinite;
}
@keyframes walk{
  from{transform:rotate(10deg)}
  to{transform:rotate(-10deg)}
}

/* ===== KONTROLLER ===== */
#controls{
  display:flex;
  justify-content:center;
  gap:30px;
  padding:12px;
  background:#0f172a;
}
button{
  font-size:1.8rem;
  padding:12px 18px;
  border-radius:14px;
  border:none;
  background:#1e3a8a;
  color:white;
}

/* ===== MATTE ===== */
#mathOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.gridWrapper{
  background:white;
  padding:16px;
  border:3px solid #0f172a;
}
.grid{
  display:grid;
  grid-template-columns:56px 56px 56px;
  grid-template-rows:56px 56px 56px 56px;
}
.cell{
  border:2px solid black;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2rem;
}
.row3{ border-bottom:6px solid black !important; }
.ones{ color:#16a34a; font-weight:700; }
.tens{ color:#2563eb; font-weight:600; }
input{
  width:100%;
  height:100%;
  border:none;
  font-size:2rem;
  text-align:center;
  background:transparent;
}
</style>
</head>

<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>
    <div class="sun"></div>

    <!-- MILJ√ñ -->
    <div class="tree" style="left:300px"></div>
    <div class="tree" style="left:1500px"></div>
    <div class="bush" style="left:600px"></div>
    <div class="bush" style="left:1800px"></div>
    <div class="flower" style="left:500px"></div>
    <div class="flower" style="left:540px"></div>

    <!-- KULLAR -->
    <div class="hill platform" style="left:900px"></div>
    <div class="hill platform" style="left:2600px"></div>

    <!-- UPPGIFTER -->
    <div class="hedgehog obstacle" style="left:700px"></div>
    <div class="cube obstacle" style="left:1300px">?</div>
    <div class="hedgehog obstacle" style="left:2100px"></div>
    <div class="cube obstacle" style="left:3200px">?</div>
    <div class="hedgehog obstacle" style="left:4200px"></div>

    <!-- M√ÖL -->
    <div class="flag" id="flag">
      <div class="flagpole"></div>
      <div class="flagcloth"></div>
    </div>
  </div>

  <div id="player">
    <div class="head">üôÇ</div>
    <div class="body">
      <div class="arm left"></div>
      <div class="arm right"></div>
    </div>
    <div class="legs">
      <div class="leg"></div><div class="leg"></div>
    </div>
  </div>
</div>

<div id="controls">
  <button id="leftBtn">‚¨ÖÔ∏è</button>
  <button id="jumpBtn">‚¨ÜÔ∏è</button>
  <button id="rightBtn">‚û°Ô∏è</button>
</div>

<audio id="bgMusic" src="Music.mp3" loop></audio>
<audio id="successSound" src="Correct.mp3"></audio>
<audio id="jumpSound" src="Jump.mp3"></audio>
<audio id="finishSound" src="Finish.mp3"></audio>

<script>
/* ===== LJUDSTART ===== */
let audioStarted=false;
function startAudio(){
  if(!audioStarted){
    bgMusic.volume=0.3;
    bgMusic.play().catch(()=>{});
    audioStarted=true;
  }
}

/* ===== MATTE ===== */
const tasks=["39+15","63+28","58+34","49+32","27+46"];
let taskIndex=0, correct=0, paused=false, finished=false;

/* ===== SPEL ===== */
let worldX=0,vy=0,onGround=true,left=false,right=false;
const speed=3,gravity=0.6;

leftBtn.onpointerdown=()=>{left=true;player.classList.add("walking");startAudio();};
leftBtn.onpointerup=()=>{left=false;player.classList.remove("walking");};
rightBtn.onpointerdown=()=>{right=true;player.classList.add("walking");startAudio();};
rightBtn.onpointerup=()=>{right=false;player.classList.remove("walking");};

jumpBtn.onpointerdown=()=>{
  startAudio();
  if(onGround){
    jumpSound.play().catch(()=>{});
    vy=11; onGround=false;
  }
};

function loop(){
  let next=worldX;
  if(right)next-=speed;
  if(left)next+=speed;

  vy-=gravity;
  let bottom=parseFloat(player.style.bottom||80)+vy;
  onGround=false;

  document.querySelectorAll(".platform").forEach(p=>{
    const pr=player.getBoundingClientRect();
    const r=p.getBoundingClientRect();
    if(pr.bottom<=r.top+10 && pr.right>r.left && pr.left<r.right && vy<=0){
      bottom = r.top - game.getBoundingClientRect().bottom;
      vy=0; onGround=true;
    }
  });

  if(bottom<=80){ bottom=80; vy=0; onGround=true; }

  world.style.left=next+"px";
  worldX=next;
  player.style.bottom=bottom+"px";

  /* FLAGGA */
  const pr=player.getBoundingClientRect();
  const fr=flag.getBoundingClientRect();
  if(pr.right>fr.left && !finished){
    finished=true;
    flag.classList.add("raised");
    bgMusic.volume=0.1;
    finishSound.play().catch(()=>{});
  }

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
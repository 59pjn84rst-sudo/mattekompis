<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mattepromenaden</title>

<style>
* { user-select:none; -webkit-user-select:none; }
body { margin:0; font-family:system-ui; background:#60a5fa; overflow:hidden; }

/* ===== SPEL ===== */
#game {
  position:relative;
  width:100vw;
  height:60vh;
  background:linear-gradient(#60a5fa,#86efac);
  overflow:hidden;
}
#world {
  position:absolute;
  bottom:0;
  left:0;
  height:100%;
  width:4000px;
}
.ground {
  position:absolute;
  bottom:0;
  height:80px;
  width:4000px;
  background:#22c55e;
}

/* ===== HINDER ===== */
.obstacle {
  position:absolute;
  width:50px;
  height:40px;
  background:#7c3aed;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:1.6rem;
  font-weight:700;
}

/* ===== GUBBE ===== */
#player {
  position:absolute;
  left:45%;
  bottom:80px;
  width:40px;
  height:64px;
}
.head {
  width:24px;
  height:24px;
  background:#fde68a;
  border-radius:50%;
  margin:auto;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
}
.hair {
  position:absolute;
  top:0;
  left:8px;
  width:24px;
  height:10px;
  background:#facc15;
  border-radius:8px 8px 0 0;
}
.body {
  width:40px;
  height:28px;
  background:#2563eb;
  border-radius:8px;
  margin-top:4px;
}
.legs {
  display:flex;
  justify-content:space-between;
}
.leg {
  width:16px;
  height:20px;
  background:#1e293b;
  border-radius:6px;
}

/* ===== KONTROLLER ===== */
#controls {
  display:flex;
  justify-content:center;
  gap:30px;
  padding:12px;
  background:#0f172a;
}
button {
  font-size:1.8rem;
  padding:12px 18px;
  border-radius:14px;
  border:none;
  background:#1e3a8a;
  color:white;
}

/* ===== MATTE ===== */
#mathOverlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}

.gridWrapper {
  background:white;
  padding:16px;
  border:3px solid #0f172a;
}

.grid {
  width:168px;
  height:252px;
  display:grid;
  grid-template-columns:56px 56px 56px;
  grid-template-rows:63px 63px 63px 63px;
  position:relative;
}

/* rutlinjer bakom */
.grid::before {
  content:"";
  position:absolute;
  inset:0;
  z-index:0;
  background:
    linear-gradient(to right,
      transparent 0,transparent 56px,#000 56px,#000 58px,
      transparent 58px,transparent 112px,#000 112px,#000 114px,
      transparent 114px),
    linear-gradient(to bottom,
      transparent 0,transparent 63px,#000 63px,#000 65px,
      transparent 65px,
      transparent 126px,#000 126px,#000 128px,
      transparent 128px,
      transparent 189px,#000 189px,#000 195px);
}

.cell {
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2.2rem;
  z-index:1;
}
.tens { color:#2563eb; font-weight:600; }
.ones { color:#16a34a; font-weight:700; background:#f1f5f9; }
.op { font-weight:700; }

input {
  width:100%;
  height:100%;
  border:none;
  font-size:2rem;
  text-align:center;
  background:transparent;
}

/* HIGHLIGHTS */
.green-focus {
  box-shadow:0 0 0 3px rgba(22,163,74,.45);
  border-radius:6px;
}
.blue-focus {
  box-shadow:0 0 0 3px rgba(37,99,235,.45);
  border-radius:6px;
}
</style>
</head>

<body>

<div id="game">
  <div id="world">
    <div class="ground"></div>

    <div class="obstacle" data-index="0" style="left:900px; bottom:80px">?</div>
    <div class="obstacle" data-index="1" style="left:1800px; bottom:80px">?</div>
    <div class="obstacle" data-index="2" style="left:2700px; bottom:80px">?</div>
  </div>

  <div id="player">
    <div class="head">üôÇ</div>
    <div class="hair"></div>
    <div class="body"></div>
    <div class="legs">
      <div class="leg"></div>
      <div class="leg"></div>
    </div>
  </div>
</div>

<div id="controls">
  <button id="leftBtn">‚¨ÖÔ∏è</button>
  <button id="jumpBtn">‚¨ÜÔ∏è</button>
  <button id="rightBtn">‚û°Ô∏è</button>
</div>

<div id="mathOverlay">
  <div class="gridWrapper">
    <div class="grid" id="mathGrid"></div>
    <div style="text-align:center;margin-top:10px">
      <button onclick="checkAnswer()">Klar</button>
    </div>
  </div>
</div>

<script>
/* ===== VECKANS TAL ===== */
const weeklyTasks = `
39+15
63+28
58+34
49+32
57+36
78+16
56+34
37+45
`.trim().split("\n");

let taskIndex = 0;
let correctAnswer = 0;
let paused = false;
let currentObstacle = null;

let worldX=0, vy=0, onGround=true;
let left=false, right=false;
const gravity=0.6, speed=3;

leftBtn.onpointerdown=e=>{e.preventDefault();left=true};
leftBtn.onpointerup=()=>left=false;
rightBtn.onpointerdown=e=>{e.preventDefault();right=true};
rightBtn.onpointerup=()=>right=false;
jumpBtn.onpointerdown=e=>{e.preventDefault(); if(onGround){vy=11;onGround=false;}};

function showMath(ob){
  paused = true;
  currentObstacle = ob;

  const [a,b] = weeklyTasks[taskIndex].split("+").map(Number);
  correctAnswer = a + b;

  const grid = document.getElementById("mathGrid");
  grid.innerHTML = "";

  const cells = [
    "", "", "",
    "", Math.floor(a/10), a%10,
    "+", Math.floor(b/10), b%10,
    "input", "input", "input"
  ];

  cells.forEach((v,i)=>{
    const d=document.createElement("div");
    d.className="cell";
    if(i%3===1 && typeof v==="number") d.classList.add("tens");
    if(i%3===2 && typeof v==="number") d.classList.add("ones");
    if(v==="+") d.classList.add("op");

    if(v==="input"){
      const inp=document.createElement("input");
      inp.inputMode="numeric";
      inp.maxLength=1;
      d.appendChild(inp);
    } else if(typeof v==="number"){
      d.textContent=v;
    }
    grid.appendChild(d);
  });

  // GR√ñNT: endast entalssiffror
  document.querySelectorAll(".ones").forEach(c=>c.classList.add("green-focus"));

  // BL√ÖTT: tiotal efter entalssvar
  const inputs=document.querySelectorAll("#mathGrid input");
  inputs[2].addEventListener("input",()=>{
    document.querySelectorAll(".green-focus").forEach(c=>c.classList.remove("green-focus"));
    document.querySelectorAll(".tens").forEach(c=>c.classList.add("blue-focus"));
  },{once:true});

  document.getElementById("mathOverlay").style.display="flex";
}

function checkAnswer(){
  const val=[...document.querySelectorAll("#mathGrid input")]
    .map(i=>i.value||"").join("");
  if(parseInt(val)===correctAnswer){
    currentObstacle.remove();
    taskIndex++;
    paused=false;
    document.getElementById("mathOverlay").style.display="none";
  }
}

function loop(){
  if(!paused){
    let nextWorldX=worldX;
    if(right) nextWorldX-=speed;
    if(left) nextWorldX+=speed;

    vy-=gravity;
    let bottom=parseFloat(player.style.bottom||80)+vy;
    if(bottom<=80){bottom=80;vy=0;onGround=true;}

    world.style.left=nextWorldX+"px";
    const pr=player.getBoundingClientRect();

    document.querySelectorAll(".obstacle").forEach(ob=>{
      const r=ob.getBoundingClientRect();
      if(pr.right>r.left && pr.left<r.right){
        showMath(ob);
      }
    });

    worldX=nextWorldX;
    player.style.bottom=bottom+"px";
  }
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>